import streamlit as st
import numpy as np
import pickle
import os

# Load the model
model_path = os.path.join(os.path.dirname(__file__), 'model.pkl')
try:
    with open(model_path, 'rb') as file:
        model = pickle.load(file)
except FileNotFoundError:
    st.error(f"Model file not found at {model_path}. Please ensure the file is present.")
except Exception as e:
    st.error(f"An error occurred while loading the model: {e}")

# Streamlit app
def main():
    # Set the page title and layout
    st.set_page_config(page_title="Big Mart Sales Prediction", page_icon="ðŸ›’", layout="centered")

    # Set custom styling
    st.markdown("""
        <style>
            .main-title {
                color: #212529;
                text-align: center;
                font-size: 36px;
                font-weight: bold;
            }
            .sub-title {
                color: #ffc107;
                text-align: center;
                font-size: 24px;
                font-weight: bold;
            }
            .form-control {
                background-color: #495057;
                border: 1px solid #ced4da;
                color: #f8f9fa;
                padding: 10px;
                margin-bottom: 10px;
            }
            .form-control input {
                border-radius: 5px;
            }
            .btn-predict {
                background-color: #28a745;
                border: none;
                padding: 15px;
                color: white;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
                width: 100%;
            }
            .btn-predict:hover {
                background-color: #218838;
            }
            .prediction-result {
                background-color: #212529;
                color: #ffc107;
                padding: 20px;
                border-radius: 5px;
                margin-top: 20px;
                text-align: center;
                font-size: 24px;
                font-weight: bold;
            }
        </style>
    """, unsafe_allow_html=True)

    # Title and sub-title
    st.markdown('<h1 class="main-title">Big Mart Sales Prediction Using Machine Learning</h1>', unsafe_allow_html=True)
    st.markdown('<h2 class="sub-title">Input All Features Below</h2>', unsafe_allow_html=True)
    
    # Input fields
    Item_MPR = st.number_input("Item MRP", min_value=0.0, max_value=1000.0, value=0.0, step=0.1, format="%.2f")
    Outlet_type = st.number_input("Outlet Type", min_value=0.0, max_value=5.0, value=0.0, step=1.0, format="%.2f")
    Outlet_identifier = st.number_input("Outlet Identifier", min_value=0.0, max_value=50.0, value=0.0, step=1.0, format="%.2f")
    Outlet_size = st.number_input("Outlet Size", min_value=0.0, max_value=5.0, value=0.0, step=1.0, format="%.2f")
    Item_visibility = st.number_input("Item Visibility", min_value=0.0, max_value=1.0, value=0.0, step=0.01, format="%.2f")
    Outlet_location_type = st.number_input("Outlet Location Type", min_value=0.0, max_value=5.0, value=0.0, step=1.0, format="%.2f")
    Outlet_established_year = st.number_input("Outlet Established Year", min_value=1900, max_value=2024, value=2000, step=1)

    # Prediction button
    if st.button("Predict"):
        if 'model' in globals():
            # Create a numpy array of the inputs
            features = np.array([[Item_MPR, Outlet_type, Outlet_identifier, Outlet_size, Item_visibility, Outlet_location_type, Outlet_established_year]], dtype=np.float32)

            try:
                # Predict using the loaded model
                prediction = model.predict(features)[0]
                # Display the prediction result with styling
                st.markdown(f'<div class="prediction-result">The Predicted Sales Value is: {prediction:.2f}</div>', unsafe_allow_html=True)
                # Add a balloon animation for a visual effect
                st.balloons()
                st.success(f"Prediction completed successfully! The predicted sales value is: {prediction:.2f}")
            except Exception as e:
                st.error(f"An error occurred during prediction: {e}")
        else:
            st.error("Model not loaded. Please check if the model file is in the correct directory.")

if __name__ == '__main__':
    main()
